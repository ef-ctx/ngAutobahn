/**********************************************************
 * 
 * ngAutobahn - v0.0.24
 * 
 * Release date : 2016-04-12 : 15:02
 * Author       : Jaime Beneytez - EF CTX 
 * License      : MIT 
 * 
 **********************************************************/



!function(a){"use strict";a.module("ngAutobahn.connection",[]).constant("NG_AUTOBAHN_CONNECTION_STATUS",{OPENED:"ngAutobahn.connection.state.opened",CLOSED:"ngAutobahn.connection.state.closed",LOST:"ngAutobahn.connection.state.lost"}).constant("NG_AUTOBAHN_CONNECTION_EVENTS",{OPEN:"ngAutobahn.connection.open",CLOSE:"ngAutobahn.connection.close",LOST:"ngAutobahn.connection.lost"}).provider("ngAutobahnConnection",[function(){var b={},c={mockMode:!1,url:null,realm:null,retries:{max:100,initialDelay:3,delayGrowthFactor:1.5,maxDelay:300,delayJitter:.1}};this.configure=function(d){a.extend(c,d),b={url:c.url,realm:c.realm,max_retries:c.retries.max,initial_retry_delay:c.retries.initialDelay,retry_delay_growth:c.retries.delayGrowthFactor,max_retry_delay:c.retries.maxDelay,retry_delay_jitter:c.retries.delayJitter}},this.$get=["$q","$rootScope","NG_AUTOBAHN_CONNECTION_STATUS","NG_AUTOBAHN_CONNECTION_EVENTS",function(a,c,d,e){function f(){function f(){function c(a,b){return o.onclose=null,"lost"===a?void l(b):(o=null,void k(b))}function d(){o.onclose=null,f.reject()}function e(a){n=a,f.resolve(n),j(n),o.onclose=c}var f=a.defer();return o&&n?(f.resolve(n),j()):(o=new autobahn.Connection(b),o.onopen=e,o.onclose=d,o.open()),f.promise}function g(){return h().then(k)}function h(){function b(a,b){o.onclose=null,o=null,c.resolve(b)}var c=a.defer();return o?(o.onclose=b,o.close()):c.reject(),c.promise}function i(){l({reason:"connection.reset"}),h().then(f)}function j(a){m(d.OPENED,a,e.OPEN)}function k(a){m(d.CLOSED,a,e.CLOSE)}function l(a){m(d.LOST,a,e.LOST)}function m(a,b,d){var e=q;q=a,c.$broadcast(d,b,e)}var n,o,p=this,q=d.CLOSED;p.openConnection=f,p.closeConnection=g,p.resetConnection=i,Object.defineProperty(p,"status",{get:function(){return q}}),Object.defineProperty(p,"isOpen",{get:function(){return q===d.OPENED}}),Object.defineProperty(p,"isClosed",{get:function(){return q===d.CLOSED}}),Object.defineProperty(p,"isLost",{get:function(){return q===d.LOST}})}return new f}]}])}(angular),function(a){"use strict";a.module("ngAutobahn.messageBroker",[]).factory("NgAutobahnMessageBroker",["$rootScope",function(a){function b(b,c){function d(a,b){k[a]||(k[a]=[]),k[a].push(b)}function e(a,b){return c(j,a,b)}function f(){return j}function g(b,c){var d=c.channel,e=c.type,f=c.data;h(d,e)&&(i(e,f),a.$applyAsync())}function h(a,b){return j===a&&k[b]}function i(a,b){for(var c=k[a],d=0;d<c.length;d++)c[d](b)}var j=b,k={};return{facade:{publish:e,subscribe:d,getChannel:f},messageReceivedHandler:g,subscription:null,channel:j}}return b}])}(angular),function(a){"use strict";a.module("ngAutobahn",["ngAutobahn.connection","ngAutobahn.session"])}(angular),function(a){"use strict";a.module("ngAutobahn.session",["ngAutobahn.connection","ngAutobahn.messageBroker"]).service("ngAutobahnSession",["$q","$rootScope","ngAutobahnConnection","NgAutobahnMessageBroker","NG_AUTOBAHN_CONNECTION_EVENTS",function(a,b,c,d,e){function f(){function f(b){function c(){return q(b)}function d(b){a.reject("ngAutobahnSession.subscribe Error: ",b),p()}if(!b)throw new Error("ngAutobahn.session.subscribe error: Trying to subscribe without specifying channel");return y?c():n().then(c)["catch"](d)}function g(b,c){function d(){return y.isOpen?y.call(b,[],c||{}):a.reject("session is not open")}return y?d():n().then(d)}function h(a){if(a)return w(t(a)).then(r);throw new Error("ngAutobahnSession.unsubscribeBroker error. No broker provided")}function i(){var b=a.defer();return x(),s(),c.closeConnection().then(b.resolve,b.reject),b.promise}function j(a,b){y||(o(b),v())}function k(a,b){s(),p()}function l(a,b){p()}function m(b,c,d){var e=a.defer(),f={type:c,data:d||{}},g={acknowledge:!0};return y?y.publish(b,[],f,g).then(e.resolve,e.reject):e.reject("ngAutobahnConnection error no session was established"),e.promise}function n(){return c.openConnection().then(o)}function o(a){y=a}function p(){y=null}function q(a){function b(){z.push(e)}function c(){return e.facade}var e=new d(a,m);return u(e).then(c)["finally"](b)}function r(a){return z.splice(z.indexOf(a),1)}function s(){z=[]}function t(a){for(var b,c=0;c<z.length;c++)if(b=z[c],b.facade===a)return b;return null}function u(b){function c(a){return b.subscription=a,b}return y.subscribe(b.channel,b.messageReceivedHandler).then(c)["catch"](a.reject)}function v(){z.forEach(u)}function w(b){function c(){d.resolve(b)}var d=a.defer();return y.unsubscribe(b.subscription).then(c,d.reject),d.promise}function x(){z.forEach(w)}var y,z=[];this.subscribe=f,this.remoteCall=g,this.unsubscribeBroker=h,this.end=i,b.$on(e.OPEN,j),b.$on(e.CLOSE,k),b.$on(e.LOST,l)}return new f}])}(angular),function(a){"use strict";function b(b){function c(b){return a.extend(f,b),d(f),f}function d(a){b.configure(a)}function e(a,b,c,d,e){function g(){function g(){return b.resetConnection()}function h(){return c.remoteCall(f.pingMessage)}var i=this,j=new d(h,g);i.activate=function(){a.$on(e.OPEN,j.start),a.$on(e.LOST,j.stop),a.$on(e.CLOSE,j.stop),b.isOpened&&j.start()}}return new g}var f={pingMessage:"ping",intervalMs:3e3};this.configure=c,this.$get=["$rootScope","ngAutobahnConnection","ngAutobahnSession","NgAutobahnPing","NG_AUTOBAHN_CONNECTION_EVENTS",e]}a.module("ngAutobahn.utils.connectionPing",["ngAutobahn","ngAutobahn.utils.ping"]).provider("ngAutobahnConnectionPing",["NgAutobahnPingProvider",b])}(angular),function(a){"use strict";function b(){function b(b){a.extend(d,b)}function c(a,b){function c(a,c){function e(){l&&k(),l=b(f,d.intervalMs,0,!1)}function f(){m?h():(k(),i())}function g(){k(),m=!0}function h(){m=!1,a().then(j)}function i(){c()}function j(){m=!0}function k(){b.cancel(l),l=null}var l,m=!0;this.start=e,this.stop=g}return c}var d={intervalMs:3e3};this.configure=b,this.$get=["$timeout","$interval",c]}a.module("ngAutobahn.utils.ping",[]).provider("NgAutobahnPing",[b])}(angular);