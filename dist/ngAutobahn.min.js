!function(a){"use strict";a.module("ngAutobahn.connection",[]).constant("NG_AUTOBAHN_CONNECTION_STATUS",{OPENED:"ngAutobahn.connection.state.opened",CLOSED:"ngAutobahn.connection.state.closed",LOST:"ngAutobahn.connection.state.lost"}).constant("NG_AUTOBAHN_CONNECTION_EVENTS",{OPEN:"ngAutobahn.connection.open",CLOSE:"ngAutobahn.connection.close",LOST:"ngAutobahn.connection.lost"}).provider("ngAutobahnConnection",[function(){var b={},c={mockMode:!1,url:null,realm:null,retries:{max:100,initialDelay:3,delayGrowthFactor:1.5,maxDelay:300,delayJitter:.1}};this.configure=function(d){a.extend(c,d),b={url:c.url,realm:c.realm,max_retries:c.retries.max,initial_retry_delay:c.retries.initialDelay,retry_delay_growth:c.retries.delayGrowthFactor,max_retry_delay:c.retries.maxDelay,retry_delay_jitter:c.retries.delayJitter}},this.$get=["$q","$rootScope","NG_AUTOBAHN_CONNECTION_STATUS","NG_AUTOBAHN_CONNECTION_EVENTS",function(a,c,d,e){function f(){function f(){var c=a.defer();return q?(c.resolve(p),l()):(q=new autobahn.Connection(b),q.onopen=function(a){p=a,c.resolve(a),l()},q.onclose=function(a){c.reject(),j()},q.open()),c.promise}function g(){return h().then(k)}function h(){var b=a.defer();return q?(q.onclose=function(a){q=null,b.resolve()},q.close()):b.reject(),b.promise}function i(){j(),h().then(f)}function j(){s=d.LOST,o()}function k(){s=d.CLOSED,n()}function l(){s=d.OPENED,m()}function m(){c.$broadcast(e.OPEN,p)}function n(a){c.$broadcast(e.CLOSE,a)}function o(a){c.$broadcast(e.LOST,a)}var p,q,r=this,s=d.CLOSED;r.openConnection=f,r.closeConnection=g,r.resetConnection=i,Object.defineProperty(r,"status",{get:function(){return s}}),Object.defineProperty(r,"isOpen",{get:function(){return s===d.OPENED}}),Object.defineProperty(r,"isClosed",{get:function(){return s===d.CLOSED}}),Object.defineProperty(r,"isLost",{get:function(){return s===d.LOST}})}return new f}]}])}(angular),function(a){"use strict";a.module("ngAutobahn.messageBroker",[]).factory("NgAutobahnMessageBroker",["$rootScope",function(a){function b(a,b){function c(a,b){j[a]||(j[a]=[]),j[a].push(b)}function d(a,c){return b(i,a,c)}function e(){return i}function f(a,b){var c=b.channel,d=b.type,e=b.data;g(c,d)&&h(d,e)}function g(a,b){return i===a&&j[b]}function h(a,b){for(var c=j[a],d=0;d<c.length;d++)c[d](b)}var i=a,j={};return{facade:{publish:d,subscribe:c,getChannel:e},messageReceivedHandler:f,subscription:null,channel:i}}return b}])}(angular),function(a){"use strict";a.module("ngAutobahn",["ngAutobahn.connection","ngAutobahn.session"])}(angular),function(a){"use strict";a.module("ngAutobahn.session",["ngAutobahn.connection","ngAutobahn.messageBroker"]).service("ngAutobahnSession",["$q","$rootScope","ngAutobahnConnection","NgAutobahnMessageBroker","NG_AUTOBAHN_CONNECTION_EVENTS",function(a,b,c,d,e){function f(){function f(b){function e(){h(i),f.resolve(i.facade)}var f=a.defer(),i=new d(b,n);if(!b)throw new Error("ngAutobahn.session.subscribe error: Trying to subscribe without specifying channel");return v?e():c.openConnection().then(g)["finally"](e),f.promise}function g(a){v=a}function h(a){function b(b){a.subscription=b,w[b.id]=a}v.subscribe(a.channel,a.messageReceivedHandler).then(b)}function i(){for(var a in w){var b=w[a];h(b)}}function j(a){if(!a)throw new Error("ngAutobahnSession.unsubscribeBroker error. No broker provided");var b=u(a);r(b)}function k(a,b){v||(v=b,i())}function l(a,b){s(),v=null}function m(a,b){function d(){return v.call(a,[],e)}var e=b||{};return v?d():c.openConnection().then(d)}function n(c,d,e){var f,g,h=a.defer();return v?(f=o(d,e),g={acknowledge:!0},v.publish(c,[],o(d,e),g).then(h.resolve,h.reject)["finally"](b.$applyAsync)):h.reject("ngAutobahnConnection error no session was established"),h.promise}function o(a,b){return{type:a,data:b||{}}}function p(){return q()}function q(){var b=a.defer();return s(),t(),c.closeConnection().then(b.resolve,b.reject),b.promise}function r(a){v.unsubscribe(a.subscription)}function s(){for(var a in w)r(w[a])}function t(){w={}}function u(a){var b;for(var c in w)if(b=w[c],a===b.facade)return b;return null}var v,w={};this.subscribe=f,this.remoteCall=m,this.end=p,this.unsubscribeBroker=j,b.$on(e.OPEN,k),b.$on(e.CLOSE,l),b.$on(e.LOST,l)}return new f}])}(angular),function(a){"use strict";a.module("ngAutobahn.utils.connectionPing",["ngAutobahn","ngAutobahn.utils.ping"]).provider("ngAutobahnConnectionPing",["NgAutobahnPingProvider",function(b){var c=this,d={pingMessage:"ping",delay:1500,maxResponseDelay:3e3};b.configure({delay:d.delay,maxResponseDelay:d.maxResponseDelay}),c.configure=function(b){return a.extend(d,b),d},c.$get=["$rootScope","ngAutobahnConnection","ngAutobahnSession","NgAutobahnPing","NG_AUTOBAHN_CONNECTION_EVENTS",function(a,b,c,e,f){function g(){function g(){return b.resetConnection()}function h(){return c.remoteCall(d.pingMessage)}var i=this,j=new e(h,g);i.activate=function(){a.$on(f.OPEN,j.start),a.$on(f.LOST,j.stop),a.$on(f.CLOSE,j.stop),b.isOpened&&j.start()}}return new g}]}])}(angular),function(a){"use strict";a.module("ngAutobahn.utils.ping",[]).provider("NgAutobahnPing",[function(){var b=this,c={delay:1500,maxResponseDelay:3e3};b.configure=function(b){a.extend(c,b)},b.$get=["$timeout","$interval",function(a,b){function d(d,e){function f(){g(),h(),m=b(h,c.delay,0,!1)}function g(){j(),k()}function h(){l=a(i,c.maxResponseDelay),d().then(j)}function i(){g(),e()}function j(){a.cancel(l)}function k(){b.cancel(m)}var l,m,n=this;n.start=f,n.stop=g}return d}]}])}(angular);